import os
import sys
from pathlib import Path

project_root = Path(__file__).parent
lock_file = project_root / 'maintenance.lock'


def enable_maintenance():
    lock_file.touch()

    print("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó")
    print("‚ïë     ‚úÖ –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø –í–ö–õ–Æ–ß–ï–ù              ‚ïë")
    print("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù")
    print()
    print("üì± –ù–∞ —Å–∞–π—Ç–µ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:")
    print("   ¬´–í–µ–¥–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞¬ª")
    print()
    print(f"üìÇ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: {lock_file}")
    print()
    print("üîß –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:")
    print("   ‚Ä¢ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è")
    print("   ‚Ä¢ –î–æ—Å—Ç—É–ø –∫ /admin/ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–¥–ª—è –≤–∞—Å)")
    print("   ‚Ä¢ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ")
    print()
    print("üöÄ –ß—Ç–æ–±—ã –≤—ã–∫–ª—é—á–∏—Ç—å, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:")
    print(f"   python maintenance_control.py off")
    print("   –ò–õ–ò")
    print(f"   rm {lock_file}")
    print()
    print("üåê –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://127.0.0.1:8000/")


def disable_maintenance():
    if lock_file.exists():
        lock_file.unlink()

        print("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó")
        print("‚ïë     ‚úÖ –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø –í–´–ö–õ–Æ–ß–ï–ù            ‚ïë")
        print("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù")
        print()
        print("üéâ –°–∞–π—Ç —Å–Ω–æ–≤–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!")
        print()
        print("üîÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è")
    else:
        print("‚ö†Ô∏è  –§–∞–π–ª maintenance.lock –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        print("   –†–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —É–∂–µ –≤—ã–∫–ª—é—á–µ–Ω.")


def check_status():
    if lock_file.exists():
        import datetime
        mtime = lock_file.stat().st_mtime
        file_time = datetime.datetime.fromtimestamp(mtime).strftime('%d.%m.%Y %H:%M:%S')

        print("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó")
        print("‚ïë     üî¥ –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø: –í–ö–õ–Æ–ß–ï–ù           ‚ïë")
        print("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù")
        print()
        print(f"üìÇ –§–∞–π–ª: {lock_file}")
        print(f"üïê –í–∫–ª—é—á–µ–Ω: {file_time}")
        print(f"üìè –†–∞–∑–º–µ—Ä: {lock_file.stat().st_size} –±–∞–π—Ç")
        print()
        print("‚ÑπÔ∏è  –°–µ–π—á–∞—Å –Ω–∞ —Å–∞–π—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:")
        print("   ¬´–í–µ–¥–µ—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞¬ª")
        print()
        print("‚ö° –ß—Ç–æ–±—ã –≤—ã–∫–ª—é—á–∏—Ç—å:")
        print(f"   python maintenance_control.py off")
    else:
        print("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó")
        print("‚ïë     üü¢ –†–ï–ñ–ò–ú –û–ë–°–õ–£–ñ–ò–í–ê–ù–ò–Ø: –í–´–ö–õ–Æ–ß–ï–ù          ‚ïë")
        print("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù")
        print()
        print("‚úÖ –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±—ã—á–Ω–æ–º —Ä–µ–∂–∏–º–µ")


if __name__ == "__main__":
    if len(sys.argv) > 1:
        command = sys.argv[1].lower()

        if command in ['on', 'enable', 'start', '1', 'true']:
            enable_maintenance()
        elif command in ['off', 'disable', 'stop', '0', 'false']:
            disable_maintenance()
        elif command in ['status', 'check', 'state']:
            check_status()
        else:
            print("‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: on, off –∏–ª–∏ status")
    else:
        print("""
        üõ†Ô∏è  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è —Å–∞–π—Ç–∞

        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
          python maintenance_control.py [–∫–æ–º–∞–Ω–¥–∞]

        –ö–æ–º–∞–Ω–¥—ã:
          on      - –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
          off     - –í—ã–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
          status  - –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

        –ü—Ä–∏–º–µ—Ä—ã:
          python maintenance_control.py on
          python maintenance_control.py off
          python maintenance_control.py status
        """)